//
// pasteque
// 0.0.3
// Beautify typography. Pasteque is a fork from Compass/typography.
// Zaza Agency <hi@zaza.africa> (zaza.africa)
//
// This work is licensed under the Creative Commons
// Attribution 4.0 International License. To view a copy
// of this license, visit http://creativecommons.org/licenses/by/4.0/.
//

/// Default border-color value.
/// @author shayo/pasteque
/// @group vertical-rhythm
/// @type Color
$p-border-color-global: #ccc !default;

/// Default border-style value.
/// @author compass/typography
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @type String
$p-border-style-global: "solid" !default;

/// Default border-width value.
/// @author compass/typography
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @type Number
$p-border-width-global: 1px !default;

/// Toggle vertical grid.
/// @author compass/layout
/// @group debug
/// @link http://compass-style.org/reference/compass/layout/
/// @type Bool
$pasteque-debug-toggle: true !default;

/// Vertical grid color.
/// @author compass/layout
/// @group debug
/// @link http://compass-style.org/reference/compass/layout/
/// @type Color
$pasteque-debug-color: #f00 !default;

/// Calculate rhythm units.
/// @author compass/typography
/// @example
///   p-rhythm();
/// @example
///   p-rhythm(1, 1px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Number} $minus [0]
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
/// @return {Number} Rhythm.
@function p-rhythm($lines: 1, $minus: 0, $from: null) {
  $line-height: p-get("LINE_UNIT") * p-get("LINE_MULTI") / 2;
  $_return: p-convert-length((($lines * $line-height) - $minus), $p-unit-global, $from);

  @if (unit($_return) == "px") {
    $_return: floor($_return);
  }

  @if ($_return == 0) {
    $_return: $_return / ($_return * 0 + 1);
  }

  @return $_return;
}

/// Calculate the minimum multiple of rhythm units needed to contain a length.
/// @access private
/// @alias p-lines-for-font-size
/// @author shayo/pasteque
/// @example
///   _p-lines-for(16px);
/// @group vertical-rhythm
/// @parameter {Number} $from
/// @return {Number} Multiple of rhythm units.
@function _p-lines-for($from) {
  $line-height: p-get("LINE_UNIT") * p-get("LINE_MULTI") / 2;

  @return ceil($from / $line-height);
}

/// Calculate the minimum multiple of line-height units needed to contain a font-size.
/// @access private
/// @author compass/typography
/// @example
///   p-lines-for-font-size(14px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $from
/// @return {Number} Multiple of line-height units.
@function p-lines-for-font-size($from) {
  $_this: _p-lines-for($from);
  $_return: p-get("LINE_MULTI") / 2;

  @if ($_this > $_return) {
    $_return: $_this;
  }

  @return $_return;
}

/// Establishes a font baseline.
/// @author compass/typography
/// @example
///   @include p-establish-baseline;
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
@mixin p-establish-baseline {
  $line-height: p-get("LINE_UNIT") * p-get("LINE_MULTI");

  font-size: 100%;
  line-height: p-convert-length($line-height, "em");
}

/// Show background-image used to debug vertical alignment.
/// @author shayo/pasteque
/// @example
///   @include pasteque-debug;
/// @example
///   @include pasteque-debug(#000);
/// @group debug
/// @parameter {Color} $color [$pasteque-debug-color]
@mixin pasteque-debug($color: $pasteque-debug-color) {
  $line-unit: p-get("LINE_UNIT");
  $line-height: $line-unit * p-get("LINE_MULTI") / 2;
  $background-image: ();
  $background-size: ();

  @each $roloc, $rhythm in (rgba($color, 0.2), $line-unit), (rgba($color, 0.6), $line-height) {
    $background-image: append($background-image, linear-gradient(to top, #{$roloc} #{percentage(1px / $rhythm)}, transparent #{percentage(1px / $rhythm)}), "comma");
    $background-size: append($background-size, 100% p-convert-length($rhythm, $p-unit-global), "comma");
  }

  //noinspection CssOptimizeSimilarProperties
  background-image: $background-image;
  //noinspection CssOptimizeSimilarProperties
  background-position: top right;
  @include _p-rem("background-size", $background-size);
}

/// Adjust a block to have different line height to maintain the rhythm.
/// @author compass/typography
/// @example
///   @include p-line-height(14px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines - Multiples of baseline rhythm.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-line-height($lines, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  $default: p-get("LINE_MULTI") / 2;

  @if (unitless($lines)) {
    @if ($lines > $default) {
      $default: $lines;
    }
  }
  @else {
    $lines: p-convert-length($lines, "px", $from);
    $default: p-lines-for-font-size($lines);
  }

  @include _p-rem("line-height", p-rhythm($default, 0, $from));
}

/// Adjust a block to have a different font size and line height to maintain the rhythm.
/// @author compass/typography
/// @example
///   @include p-font-size(16px);
/// @example
///   @include p-font-size(0);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $to
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-font-size($to, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  @if (unitless($to)) {
    $to: p-ts($to);
  }

  @include _p-rem("font-size", p-convert-length($to, $p-unit-global, $from));
  @include p-line-height($to, $from);
}

/// Apply leading whitespace as padding.
/// @author compass/typography
/// @example
///   @include p-padding-top;
/// @example
///   @include p-padding-top(2);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-padding-top($lines: 1, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  @if (not unitless($lines)) {
    $lines: _p-lines-for($lines);
  }

  @include _p-rem("padding-top", p-rhythm($lines, 0, $from));
}

/// Apply trailing whitespace as padding.
/// @author compass/typography
/// @example
///   @include p-padding-bottom;
/// @example
///   @include p-padding-bottom(2);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-padding-bottom($lines: 1, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  @if (not unitless($lines)) {
    $lines: _p-lines-for($lines);
  }

  @include _p-rem("padding-bottom", p-rhythm($lines, 0, $from));
}

/// Shorthand mixin to apply whitespace for any side as padding.
/// @author compass/typography
/// @example
///   @include p-padding;
/// @example
///   @include p-padding(1);
/// @example
///   @include p-padding($right: 1);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $top [1] - Multiples of baseline rhythm to apply as leading whitespace as padding.
/// @parameter {Number} $right [0] - Multiples of baseline rhythm to apply as whitespace as padding-right.
/// @parameter {Number} $bottom [$top] - Multiples of baseline rhythm to apply as trailing whitespace as padding.
/// @parameter {Number} $left [$right] - Multiples of baseline rhythm to apply as whitespace as padding-left.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-padding($top: 1, $right: 0, $bottom: $top, $left: $right, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  $values: ();

  @each $key, $value in ("top": $top, "right": $right, "bottom": $bottom, "left": $left) {
    @if (not unitless($value)) {
      $value: _p-lines-for($value);
    }

    $rhythm: p-rhythm($value, 0, $from);

    @if ($rhythm > 0) {
      $values: map-merge($values, ($key: $rhythm));
    }
  }

  @if (map-get($values, "top") == map-get($values, "right")) and (map-get($values, "top") == map-get($values, "bottom")) and (map-get($values, "top") == map-get($values, "left")) {
    @include _p-rem("padding", map-get($values, "top"));
  }
  @else if (map-has-key($values, "top")) and (map-get($values, "top") == map-get($values, "bottom")) and (map-has-key($values, "right")) and (map-get($values, "right") == map-get($values, "left")) {
    @include _p-rem("padding", map-get($values, "top") map-get($values, "right"));
  }
  @else if (map-has-key($values, "top")) and (map-has-key($values, "right")) and (map-has-key($values, "bottom")) and (map-has-key($values, "left")) {
    @include _p-rem("padding", map-get($values, "top") map-get($values, "right") map-get($values, "bottom") map-get($values, "left"));
  }
  @else {
    @if (map-has-key($values, "top")) {
      @include _p-rem("padding-top", map-get($values, "top"));
    }

    @if (map-has-key($values, "right")) {
      @include _p-rem("padding-right", map-get($values, "right"));
    }

    @if (map-has-key($values, "bottom")) {
      @include _p-rem("padding-bottom", map-get($values, "bottom"));
    }

    @if (map-has-key($values, "left")) {
      @include _p-rem("padding-left", map-get($values, "left"));
    }
  }
}

/// Apply leading whitespace as margin.
/// @author compass/typography
/// @example
///   @include p-margin-top;
/// @example
///   @include p-margin-top(2);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-margin-top($lines: 1, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  @if (not unitless($lines)) {
    $lines: _p-lines-for($lines);
  }

  @include _p-rem("margin-top", p-rhythm($lines, 0, $from));
}

/// Apply trailing whitespace as margin.
/// @author compass/typography
/// @example
///   @include p-margin-bottom;
/// @example
///   @include p-margin-bottom(2);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-margin-bottom($lines: 1, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  @if (not unitless($lines)) {
    $lines: _p-lines-for($lines);
  }

  @include _p-rem("margin-bottom", p-rhythm($lines, 0, $from));
}

/// Shorthand mixin to apply whitespace for any side as margin.
/// @author compass/typography
/// @example
///   @include p-margin;
/// @example
///   @include p-margin(1);
/// @example
///   @include p-margin($right: 1);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $top [1] - Multiples of baseline rhythm to apply as leading whitespace as margin.
/// @parameter {Number} $right [0] - Multiples of baseline rhythm to apply as whitespace as margin-right.
/// @parameter {Number} $bottom [$top] - Multiples of baseline rhythm to apply as trailing whitespace as margin.
/// @parameter {Number} $left [$right] - Multiples of baseline rhythm to apply as whitespace as margin-left.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-margin($top: 1, $right: 0, $bottom: $top, $left: $right, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  $values: ();

  @each $key, $value in ("top": $top, "right": $right, "bottom": $bottom, "left": $left) {
    @if (not unitless($value)) {
      $value: _p-lines-for($value);
    }

    $rhythm: p-rhythm($value, 0, $from);

    @if ($rhythm != 0) {
      $values: map-merge($values, ($key: $rhythm));
    }
  }

  @if (map-get($values, "top") == map-get($values, "right")) and (map-get($values, "top") == map-get($values, "bottom")) and (map-get($values, "top") == map-get($values, "left")) {
    @include _p-rem("margin", map-get($values, "top"));
  }
  @else if (map-has-key($values, "top")) and (map-get($values, "top") == map-get($values, "bottom")) and (map-has-key($values, "right")) and (map-get($values, "right") == map-get($values, "left")) {
    @include _p-rem("margin", map-get($values, "top") map-get($values, "right"));
  }
  @else if (map-has-key($values, "top")) and (map-has-key($values, "right")) and (map-has-key($values, "bottom")) and (map-has-key($values, "left")) {
    @include _p-rem("margin", map-get($values, "top") map-get($values, "right") map-get($values, "bottom") map-get($values, "left"));
  }
  @else {
    @if (map-has-key($values, "top")) {
      @include _p-rem("margin-top", map-get($values, "top"));
    }

    @if (map-has-key($values, "right")) {
      @include _p-rem("margin-right", map-get($values, "right"));
    }

    @if (map-has-key($values, "bottom")) {
      @include _p-rem("margin-bottom", map-get($values, "bottom"));
    }

    @if (map-has-key($values, "left")) {
      @include _p-rem("margin-left", map-get($values, "left"));
    }
  }
}

/// Apply a border and whitespace to any side without destroying the vertical rhythm.
/// @access private
/// @author compass/typography
/// @example
///   @include p-apply-side-rhythm-border("all");
/// @example
///   @include p-apply-side-rhythm-border("top", 1, 1px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {String} $side - String matching a css side keyword, e.g. `top`, `right`, `bottom`, `left` or all.
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Number} $width [$p-border-width-global] - Border width.
/// @parameter {String} $style [$p-border-style-global] - Border style.
/// @parameter {Color} $color [$p-border-color-global] - Border color.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-apply-side-rhythm-border($side, $lines: 1, $width: $p-border-width-global, $style: $p-border-style-global, $color: $p-border-color-global, $from: null) {
  @if (type-of($from) == "number") and (unitless($from)) {
    $from: p-ts($from);
  }

  $padding-property: "padding";
  $border-property: "border";

  @if (index(("top", "right", "bottom", "left"), $side) != null) {
    $padding-property: $padding-property + "-#{$side}";
    $border-property: $border-property + "-#{$side}";
  }

  @if (not unitless($lines)) {
    $lines: _p-lines-for($lines);
  }

  @include _p-rem($padding-property, p-rhythm($lines, $width, $from));
  @include _p-rem($border-property, (p-convert-length($width, $p-unit-global, $from) unquote($style) $color));
}

/// Apply borders and whitespace equally to all sides.
/// @author compass/typography
/// @example
///   @include p-border;
/// @example
///   @include p-border(1, 1px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Number} $width [$p-border-width-global] - Border width.
/// @parameter {String} $style [$p-border-style-global] - Border style.
/// @parameter {Color} $color [$p-border-color-global] - Border color.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-border($lines: 1, $width: $p-border-width-global, $style: $p-border-style-global, $color: $p-border-color-global, $from: null) {
  @include p-apply-side-rhythm-border("all", $lines, $width, $style, $color, $from);
}

/// Apply a leading border.
/// @author compass/typography
/// @example
///   @include p-border-top;
/// @example
///   @include p-border-top(1, 1px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Number} $width [$p-border-width-global] - Border width.
/// @parameter {String} $style [$p-border-style-global] - Border style.
/// @parameter {Color} $color [$p-border-color-global] - Border color.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-border-top($lines: 1, $width: $p-border-width-global, $style: $p-border-style-global, $color: $p-border-color-global, $from: null) {
  @include p-apply-side-rhythm-border("top", $lines, $width, $style, $color, $from);
}

/// Apply a trailing border.
/// @author compass/typography
/// @example
///   @include p-border-bottom;
/// @example
///   @include p-border-bottom(1, 1px);
/// @group vertical-rhythm
/// @link http://compass-style.org/reference/compass/typography/
/// @parameter {Number} $lines [1] - Multiples of baseline rhythm.
/// @parameter {Number} $width [$p-border-width-global] - Border width.
/// @parameter {String} $style [$p-border-style-global] - Border style.
/// @parameter {Color} $color [$p-border-color-global] - Border color.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-border-bottom($lines: 1, $width: $p-border-width-global, $style: $p-border-style-global, $color: $p-border-color-global, $from: null) {
  @include p-apply-side-rhythm-border("bottom", $lines, $width, $style, $color, $from);
}
