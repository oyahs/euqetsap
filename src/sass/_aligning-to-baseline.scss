//
// pasteque
// 0.0.3
// Beautify typography. Pasteque is a fork from Compass/typography.
// Zaza Agency <hi@zaza.africa> (zaza.africa)
//
// This work is licensed under the Creative Commons
// Attribution 4.0 International License. To view a copy
// of this license, visit http://creativecommons.org/licenses/by/4.0/.
//

////
//// @author shayo/pasteque
//// @group aligning—to-baseline
//// @link https://medium.com/written-in-code/aligning-type-to-baseline-the-right-way-using-sass-e258fce47a9b
////

/// Calculate distance to shift text down.
/// @access private
/// @example
///   p-shift-value(16px, 0.72em);
/// @parameter {Number} $to
/// @parameter {Number} $cap-height
/// @parameter {Number} $from [null]
/// @return {Number} Distance to shift text down.
@function p-shift-value($to, $cap-height, $from: null) {
  @if (type-of($from) != "number") {
    $from: p-get("BROWSER_DEFAULT_FONT_SIZE");
  }

  $to: p-convert-length($to, "px", $from);
  $lines: p-lines-for-font-size($to);
  $to: p-convert-length($to, $p-unit-global, $from);
  $line-height: p-rhythm($lines, 0, $from);
  $cap-height: p-convert-length($cap-height, $p-unit-global, $from);
  $from: p-convert-length($from, $p-unit-global);
  $_return: $to / 2 * ($line-height * $from / $to - $cap-height) / $from;

  @if (unit($_return) == "px") {
    $_return: floor($_return);
  }

  @return $_return;
}

/// Apply leading whitespace as padding to align to baseline.
/// @example
///   @include p-adjust-padding-leader(16px, "heading");
/// @parameter {Number} $to
/// @parameter {String} $font - Key of font to get.
/// @parameter {Number} $lines [0] - Multiples of baseline rhythm to apply as leading padding.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-adjust-padding-leader($to, $font, $lines: 0, $from: null) {
  @if (map-has-key($p-fonteque, $font)) {
    @if (type-of($from) == "number") and (unitless($from)) {
      $from: p-ts($from);
    }

    @if (unitless($to)) {
      $to: p-ts($to);
    }

    $cap-height: map-get(map-get($p-fonteque, $font), "cap-height") * 1em;
    $shift-value: p-shift-value($to, $cap-height, $from);

    @if (not unitless($lines)) {
      $lines: _p-lines-for($lines);
    }

    $leader: p-rhythm($lines, 0, $from);

    @include _p-rem("padding-top", $shift-value + $leader);
  }
  @else {
    @warn "$p-fonteque has no `#{$font}` font. Output ø.";
  }
}

/// Apply trailing whitespace to align to baseline.
/// @example
///   @include p-adjust-trailing-whitespace(16px, "heading");
/// @example
///   @include p-adjust-trailing-whitespace(16px, "heading", $property: "margin");
/// @parameter {Number} $to
/// @parameter {String} $font - Key of font to get.
/// @parameter {Number} $lines [0] - Multiples of baseline rhythm to apply as trailing whitespace.
/// @parameter {String} $property ["margin"] - Can be margin or padding.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-adjust-trailing-whitespace($to, $font, $lines: 0, $property: "margin", $from: null) {
  @if (map-has-key($p-fonteque, $font)) {
    @if (type-of($from) == "number") and (unitless($from)) {
      $from: p-ts($from);
    }

    @if (unitless($to)) {
      $to: p-ts($to);
    }

    $cap-height: map-get(map-get($p-fonteque, $font), "cap-height") * 1em;
    $_shift-value: p-shift-value($to, $cap-height, $from);
    $reference: p-rhythm(1, 0, $from);
    $senil: 0;

    @if (not unitless($lines)) {
      $lines: _p-lines-for($lines);
    }

    $_trailer: p-rhythm($lines, 0, $from);

    @if ($_shift-value > ($_trailer + $reference)) {
      $px-shift: p-convert-length($_shift-value, "px", $from);
      $senil: _p-lines-for($px-shift);
    }

    $trailer: p-rhythm(($lines + $senil + 1), 0, $from);
    $shift-value: $trailer - $_shift-value;

    @include _p-rem("#{$property}-bottom", $shift-value);

    @if ($property == "margin") and ($reference > $shift-value) {
      & + * { // stylelint-disable-line scss/selector-no-redundant-nesting-selector
        margin-top: 0;
      }
    }
  }
  @else {
    @warn "$p-fonteque has no `#{$font}` font. Output ø.";
  }
}

/// Aligning text to baseline the right way.
/// @example
///   @include p-type-to-baseline(16px, "heading");
/// @parameter {Number} $to
/// @parameter {String} $font - Key of font to get.
/// @parameter {Number} $leader [0] - Multiples of baseline rhythm to apply as leading padding.
/// @parameter {Number} $trailer [$trailer] - Multiples of baseline rhythm to apply as trailing margin.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-type-to-baseline($to, $font: null, $leader: 0, $trailer: $leader, $from: null) {
  @include p-font-size($to, $from);

  @if (map-has-key($p-fonteque, $font)) {
    @include p-adjust-padding-leader($to, $font, $leader, $from);
    @include p-adjust-trailing-whitespace($to, $font, $trailer, "margin", $from);
  }
}

/// Aligning component to baseline the right way.
/// @example
///   @include p-component-to-baseline(16px, "title", 1);
/// @parameter {Number} $to
/// @parameter {String} $font - Key of font to get.
/// @parameter {Number} $lines [0] - Multiples of baseline rhythm to apply for top and bottom padding.
/// @parameter {Null|Number} $from [null] - Adjust from a font-size other than the base font-size.
@mixin p-component-to-baseline($to, $font: null, $lines: 0, $from: null) {
  @include p-font-size($to, $from);

  @if (map-has-key($p-fonteque, $font)) {
    @include p-adjust-padding-leader($to, $font, $lines, $from);
    @include p-adjust-trailing-whitespace($to, $font, $lines, "padding", $from);
  }
}
